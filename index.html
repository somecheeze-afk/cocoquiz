<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>CoCoå£±ã‚¯ã‚¤ã‚º</title>

<!-- PWA -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="CoCoå£±ã‚¯ã‚¤ã‚º">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="apple-touch-icon" href="icons/icon-180.png">

<style>
  :root { --c1:#2563eb; --bg:#f5f7fb; }
  html,body{height:100%;margin:0;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP","Yu Gothic UI","Meiryo",sans-serif}
  .container{max-width:720px;margin:0 auto;padding:16px}
  .card{background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.06);padding:20px}
  h1{margin:0 0 8px}
  .muted{color:#667085}
  button{appearance:none;border:0;border-radius:12px;background:var(--c1);color:#fff;font-weight:700;padding:14px 16px}
  button.secondary{background:#eef2ff;color:#1f2a5a}
  .opt{display:block;width:100%;text-align:left;margin:10px 0;padding:14px 16px;border-radius:12px;background:#f2f4f7;border:1px solid transparent;font-weight:600}
  .opt.correct{background:#e6f9ec;border-color:#86efac}
  .opt.incorrect{background:#fdecec;border-color:#fca5a5}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .row>*{flex:1}
  .center{display:flex;align-items:center;justify-content:center}
  input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d0d5dd;font-size:16px}
  .topspace{height:8px}
  .progress{height:8px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin:8px 0 16px}
  .bar{height:100%;background:var(--c1);width:0%}
  .chip{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#1f2a5a;font-size:12px;margin-bottom:8px}
  .splash{height:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#e0f2fe,#d1fae5)}
  .fade{animation:fade .4s ease}
  @keyframes fade {from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:none}}
</style>
</head>
<body>

<!-- Splash -->
<div id="splash" class="splash">
  <div class="center" style="flex-direction:column;gap:16px">
    <div style="font-size:96px">ğŸ›</div>
    <h1 style="margin:0">CoCoå£±ã‚¯ã‚¤ã‚º</h1>
    <div class="muted">æ•™è‚²ç”¨ãƒŸãƒ‹ã‚¢ãƒ—ãƒªï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯ï¼‰</div>
  </div>
</div>

<div id="app" style="display:none">
  <div class="container">
    <!-- Start -->
    <div id="start" class="card fade">
      <h1>CoCoå£±ã‚¯ã‚¤ã‚º</h1>
      <div class="muted">å‡ºé¡Œè¨­å®šã‚’é¸ã‚“ã§ã€Œé–‹å§‹ã€ã‚’ã‚¿ãƒƒãƒ—</div>
      <div class="topspace"></div>

      <div class="row">
        <div class="card" style="flex:1">
          <div class="muted">ã‚«ãƒ†ã‚´ãƒª</div>
          <select id="category" style="width:100%;padding:10px;border-radius:10px;border:1px solid #d0d5dd;font-size:16px"></select>
          <div style="height:12px"></div>
          <label style="display:flex;align-items:center;gap:8px">
            <input id="shuffle" type="checkbox" checked> é¸æŠè‚¢ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
          </label>
        </div>
        <div class="card" style="flex:1">
          <div class="muted">å‡ºé¡Œæ•°</div>
          <input id="qcount" type="range" min="3" max="20" step="1" value="5" style="width:100%">
          <div><strong id="qcountLabel">5</strong> å•</div>
        </div>
      </div>

      <div style="height:12px"></div>
      <button id="startBtn" style="width:100%">é–‹å§‹</button>
    </div>

    <!-- Quiz -->
    <div id="quiz" class="card fade" style="display:none">
      <div class="chip" id="catChip"></div>
      <div class="progress"><div class="bar" id="bar"></div></div>
      <h2 id="prompt" style="margin-top:0"></h2>

      <div id="choiceBox"></div>

      <div id="inputBox" style="display:none">
        <input id="answerInput" type="text" placeholder="ç­”ãˆã‚’å…¥åŠ›">
        <div style="height:10px"></div>
        <button id="answerBtn">ç­”ãˆã‚‹</button>
      </div>

      <div id="result" class="fade" style="display:none;margin-top:8px;font-weight:700"></div>

      <div style="display:flex;gap:8px;margin-top:16px">
        <button id="nextBtn" class="secondary" style="flex:1">æ¬¡ã¸</button>
      </div>
    </div>

    <!-- Result -->
    <div id="finish" class="card fade" style="display:none;text-align:center">
      <h1>çµæœ</h1>
      <p id="score" style="font-size:20px"></p>
      <div style="height:8px"></div>
      <button id="againBtn">ã‚‚ã†ä¸€åº¦</button>
    </div>
  </div>
</div>

<script>
// ====== å•é¡Œ ======
const QUESTIONS = [
  { prompt:"ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®æ­£å¼åç§°ã¯ã©ã‚Œï¼Ÿ",
    choices:["ã‚³ã‚³ã‚¹ãƒã‚¤ãƒ«ä¼ç”»","ã‚³ã‚³ãƒªã‚¿ãƒ¼ãƒ³ä¼ç”» ï½CoCoè©¦ã—ï½","ã‚³ã‚³ãƒˆãƒƒãƒ”ãƒ³ã‚°ãƒ•ã‚§ã‚¹ã‚¿","ã‚³ã‚³å†æ¥ãƒãƒ£ãƒ¬ãƒ³ã‚¸"],
    answer:"ã‚³ã‚³ãƒªã‚¿ãƒ¼ãƒ³ä¼ç”» ï½CoCoè©¦ã—ï½", category:"ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³" },
  { prompt:"ãƒˆãƒƒãƒ”ãƒ³ã‚°åˆ¸ã®ã€Œä½¿ç”¨å¯èƒ½æœŸé–“ã€ã¯ã„ã¤ã‹ã‚‰ã„ã¤ã¾ã§ï¼Ÿ",
    choices:["9/1 ï½ 10/31","ç´å“å¾Œ ï½ 10/31","10/1 ï½ 11/30","10/1 ï½ 12/31"],
    answer:"10/1 ï½ 11/30", category:"ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³" },
  { prompt:"é…å¸ƒå¯¾è±¡ã¯ã©ã‚Œï¼Ÿ",
    choices:["åº—å†…ãƒ»ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆãƒ»å®…é…ã™ã¹ã¦","åº—å†…ãƒ»ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆã®ã¿","åº—å†…ã®ã¿","å®…é…ãƒ»é…é”ä»£è¡Œã®ã¿"],
    answer:"åº—å†…ãƒ»ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆã®ã¿", category:"ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³" },
  { prompt:"ãƒˆãƒƒãƒ”ãƒ³ã‚°åˆ¸ã‚’ä½¿ã†ãŸã‚ã®æ¡ä»¶ã¯ï¼Ÿ",
    choices:["ãƒ¡ã‚¤ãƒ³æ³¨æ–‡ï¼ˆã‚«ãƒ¬ãƒ¼ï¼ã†ã©ã‚“ï¼ãƒ©ãƒ¼ãƒ¡ãƒ³ï¼ãƒ‰ãƒªã‚¢ï¼‰","ãƒ‰ãƒªãƒ³ã‚¯æ³¨æ–‡","ãŠå­æ§˜ã‚«ãƒ¬ãƒ¼ã§ã‚‚OK","ãƒˆãƒƒãƒ”ãƒ³ã‚°ã ã‘ã§ã‚‚OK"],
    answer:"ãƒ¡ã‚¤ãƒ³æ³¨æ–‡ï¼ˆã‚«ãƒ¬ãƒ¼ï¼ã†ã©ã‚“ï¼ãƒ©ãƒ¼ãƒ¡ãƒ³ï¼ãƒ‰ãƒªã‚¢ï¼‰", category:"ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³" },
  { prompt:"ãƒ¬ã‚¸ã§ã€Œã¿ã›ã‚³ã‚³Aï½Dã€ã‚’é¸ã¶ã¨ãã€Aã«è©²å½“ã™ã‚‹ã®ã¯ï¼Ÿ",
    choices:["ãƒŠã‚¹3å€‹","ã‚¯ãƒªãƒ¼ãƒ ã‚³ãƒ­ãƒƒã‚±","ã»ã†ã‚Œã‚“è‰","ãƒ•ã‚£ãƒƒã‚·ãƒ¥ãƒ•ãƒ©ã‚¤"],
    answer:"ã»ã†ã‚Œã‚“è‰", category:"ãƒ¬ã‚¸æ“ä½œ" },
  { prompt:"ãŠå®¢æ§˜ã¸ã®å£°ã‹ã‘ã§æ­£ã—ã„ã®ã¯ï¼Ÿ",
    choices:["ä»Šã™ãä½¿ãˆã‚‹ã‚¯ãƒ¼ãƒãƒ³ã§ã™ï¼","æ¥æœˆã‹ã‚‰ãŠä½¿ã„ã„ãŸã ã‘ã‚‹ãƒˆãƒƒãƒ”ãƒ³ã‚°åˆ¸ãŒå½“ãŸã‚‹ãã˜ã§ã™","é‡‘åˆ¸ã¨ã—ã¦ãŠä½¿ã„ãã ã•ã„","ãƒ‰ãƒªãƒ³ã‚¯å°‚ç”¨ã§ã™"],
    answer:"æ¥æœˆã‹ã‚‰ãŠä½¿ã„ã„ãŸã ã‘ã‚‹ãƒˆãƒƒãƒ”ãƒ³ã‚°åˆ¸ãŒå½“ãŸã‚‹ãã˜ã§ã™", category:"æ¥å®¢" },
  { prompt:"ä»–ã‚¯ãƒ¼ãƒãƒ³ã¨ã®ä½µç”¨ã¯å¯èƒ½ï¼Ÿ",
    choices:["ã™ã¹ã¦ä½µç”¨ã§ãã‚‹","ä¸€åˆ‡ä¸å¯","é‡‘åˆ¸ã¯ä½µç”¨ã§ãã‚‹ãŒã€ä»–ã‚¯ãƒ¼ãƒãƒ³ã¯ä¸å¯","ãƒˆãƒƒãƒ”ãƒ³ã‚°åˆ¸ã¨ãƒˆãƒƒãƒ”ãƒ³ã‚°åˆ¸ãªã‚‰ä½µç”¨å¯"],
    answer:"é‡‘åˆ¸ã¯ä½µç”¨ã§ãã‚‹ãŒã€ä»–ã‚¯ãƒ¼ãƒãƒ³ã¯ä¸å¯", category:"ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³" },
  { prompt:"ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ãƒ¬ã‚¸å‡¦ç†ã™ã‚‹å ´åˆã€æ­£ã—ã„æ‰‹é †ã¯ï¼Ÿ",
    choices:["SLMã‚­ãƒ¼ â†’ ã¿ã›ã‚³ã‚³","æœŸé–“é™å®šãƒˆãƒƒãƒ”ãƒ³ã‚° â†’ ã¿ã›ã‚³ã‚³","ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ æœŸé–“é™å®šãƒˆãƒƒãƒ”ãƒ³ã‚°","ã¿ã›ã‚³ã‚³ â†’ é‡‘åˆ¸"],
    answer:"æœŸé–“é™å®šãƒˆãƒƒãƒ”ãƒ³ã‚° â†’ ã¿ã›ã‚³ã‚³", category:"ãƒ¬ã‚¸æ“ä½œ" }
];

// ====== ä¾¿åˆ©é–¢æ•° & åŠ¹æœéŸ³ ======
const norm = s => (s??"").trim().toLowerCase().normalize("NFKC");
const shuffle = arr => arr.sort(()=>Math.random()-0.5);
let audioCtx;
function ping(ok=true){
  audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.type = ok ? "sine" : "square";
  if(ok){ o.frequency.setValueAtTime(880, audioCtx.currentTime);
          o.frequency.exponentialRampToValueAtTime(1320, audioCtx.currentTime+0.15); }
  else  { o.frequency.setValueAtTime(220, audioCtx.currentTime);
          o.frequency.setValueAtTime(180, audioCtx.currentTime+0.12); }
  g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.22, audioCtx.currentTime+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.25);
  o.connect(g).connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.26);
}

// ====== çŠ¶æ…‹/UIè¦ç´  ======
let pool=[], idx=0, score=0, settings={count:5, category:null, shuffle:true};
const splash=document.getElementById('splash'), app=document.getElementById('app');
const startV=document.getElementById('start'), quizV=document.getElementById('quiz'), finV=document.getElementById('finish');
const catSel=document.getElementById('category'), qRange=document.getElementById('qcount'), qLabel=document.getElementById('qcountLabel'), shuf=document.getElementById('shuffle');
const promptEl=document.getElementById('prompt'), choiceBox=document.getElementById('choiceBox');
const inputBox=document.getElementById('inputBox'), ansInput=document.getElementById('answerInput'), ansBtn=document.getElementById('answerBtn');
const resultEl=document.getElementById('result'), nextBtn=document.getElementById('nextBtn'), bar=document.getElementById('bar'), catChip=document.getElementById('catChip'), scoreEl=document.getElementById('score');

// ====== åˆæœŸåŒ– ======
setTimeout(()=>{ splash.style.display='none'; app.style.display='block'; }, 1000);
(function(){
  const cats = Array.from(new Set(QUESTIONS.map(q=>q.category))).sort();
  catSel.innerHTML = `<option value="">ï¼ˆã™ã¹ã¦ï¼‰</option>` + cats.map(c=>`<option value="${c}">${c}</option>`).join('');
  qRange.max = Math.max(QUESTIONS.length,3);
})();
qRange.addEventListener('input', ()=> qLabel.textContent = qRange.value);
document.getElementById('startBtn').onclick = ()=>{ settings.count=+qRange.value; settings.category=catSel.value||null; settings.shuffle=shuf.checked; start(); };
document.getElementById('againBtn').onclick = ()=>{ startV.style.display='block'; quizV.style.display='none'; finV.style.display='none'; };
ansBtn.onclick = ()=> checkInput(); nextBtn.onclick = ()=> next();

// ====== ãƒ­ã‚¸ãƒƒã‚¯ ======
function start(){
  pool = QUESTIONS.filter(q=>!settings.category||q.category===settings.category);
  shuffle(pool); pool = pool.slice(0, settings.count);
  idx=0; score=0; startV.style.display='none'; finV.style.display='none'; quizV.style.display='block'; render();
}
function render(){
  const q = pool[idx]; if(!q){ finish(); return; }
  bar.style.width = `${Math.round((idx)/Math.max(1,pool.length)*100)}%`;
  resultEl.style.display='none'; resultEl.textContent=''; nextBtn.disabled=true;
  catChip.textContent=q.category; promptEl.textContent=q.prompt; choiceBox.innerHTML=''; inputBox.style.display='none';
  if(q.choices && q.choices.length){
    let opts = q.choices.slice(); if(settings.shuffle) opts = shuffle(opts);
    opts.forEach(txt=>{
      const b=document.createElement('button'); b.className='opt'; b.textContent=txt;
      b.onclick=()=>{
        const ok = norm(txt)===norm(q.answer);
        if(ok){ score++; ping(true);} else { ping(false); }
        resultEl.textContent = ok ? "æ­£è§£ï¼ğŸ‰" : `æ®‹å¿µâ€¦ æ­£è§£ã¯ã€Œ${q.answer}ã€`; resultEl.style.display='block';
        [...choiceBox.children].forEach(c=>{
          const t=c.textContent;
          c.classList.add(norm(t)===norm(q.answer)?'correct':(t===txt?'incorrect':''));
          c.disabled=true;
        });
        nextBtn.disabled=false;
      };
      choiceBox.appendChild(b);
    });
  }else{
    inputBox.style.display='block'; ansInput.value=''; ansInput.focus();
  }
}
function checkInput(){
  const q=pool[idx]; const ok = norm(ansInput.value)===norm(q.answer);
  if(ok){ score++; ping(true);} else { ping(false); }
  resultEl.textContent = ok ? "æ­£è§£ï¼ğŸ‰" : `æ®‹å¿µâ€¦ æ­£è§£ã¯ã€Œ${q.answer}ã€`; resultEl.style.display='block'; nextBtn.disabled=false;
}
function next(){ idx++; if(idx>=pool.length){ finish(); } else { render(); } }
function finish(){ bar.style.width="100%"; quizV.style.display='none'; finV.style.display='block'; scoreEl.textContent=`ã‚¹ã‚³ã‚¢ï¼š ${score} / ${pool.length}`; }

// ====== Service Worker ç™»éŒ² ======
if('serviceWorker' in navigator){
  window.addEventListener('load', ()=> {
    navigator.serviceWorker.register('./sw.js').catch(console.error);
  });
}
</script>
</body>
</html>
