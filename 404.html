<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ココイチクイズ（最小版・v20250913c）</title>
  <meta name="description" content="GitHub Pagesで配布できる単一HTML版ココイチクイズ。ライス量に対するソース量・お玉の本数を覚える4択問題。" />
  <meta name="x-deploy" content="v-20250913c" />
  <!-- kill switch (念のためのSW/Cache掃除。無害・不要なら削除可) -->
  <script>
  (function killOldSW(){
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(rs => rs.forEach(r => r.unregister()));
    }
    if (window.caches) {
      caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
    }
    console.log('DEBUG HTML loaded: v-20250913c', location.href);
  })();
  </script>
  <style>
    :root{--bg:#0f172a;--panel:#111827;--panel2:#1f2937;--text:#e5e7eb;--muted:#9ca3af;--ok:#22c55e;--ng:#ef4444;--accent:#f59e0b}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b1025,#0f172a);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic UI",Meiryo,sans-serif}
    .wrap{max-width:860px;margin:0 auto;padding:24px}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
    h1{margin:0 0 8px;font-size:clamp(22px,4vw,32px)}
    h2{margin:0 0 8px;font-size:clamp(20px,3vw,26px);color:#eab308}
    .muted{color:var(--muted)}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:10px 0}
    .pill{padding:4px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.1);background:#0b1020;font-size:12px}
    .btn{appearance:none;border:none;cursor:pointer;padding:12px 16px;border-radius:12px;background:#374151;color:#fff;font-weight:700}
    .btn.primary{background:linear-gradient(90deg,#f59e0b,#f97316);color:#111}
    #home,#quiz,#result{display:none}.show{display:block}
    .choices{display:grid;gap:10px}
    .choice{padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0b1222;color:#e5e7eb;text-align:left}
    .choice[disabled]{opacity:.7;cursor:not-allowed}
    .correct{box-shadow:0 0 0 2px rgba(34,197,94,.25) inset;border-color:rgba(34,197,94,.9)}
    .wrong{box-shadow:0 0 0 2px rgba(239,68,68,.25) inset;border-color:rgba(239,68,68,.9)}
    .progress{height:10px;border-radius:999px;background:#111827;border:1px solid rgba(255,255,255,.06);overflow:hidden;margin:8px 0}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#22c55e,#f59e0b)}
    .foot{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:10px}
    input[type=number]{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:#0b1020;color:#fff}
    @media(min-width:720px){.choices{grid-template-columns:1fr 1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- HOME -->
    <section id="home" class="card show" aria-labelledby="homeTitle">
      <h1 id="homeTitle">業務知識クイズ（ライス量 → ソース量／お玉）</h1>
      <p class="muted">最小構成：スプラッシュ無し・相対パス無し・単一HTML。<br>
        <b>表示バージョン:</b> <span id="ver">v20250913c</span> ／
        <b>現在のパス:</b> <span id="path"></span>
      </p>
      <div class="row">
        <label for="qCount" class="muted">出題数</label>
        <input id="qCount" type="number" min="1" value="16" />
        <span class="pill" id="bankSize"></span>
      </div>
      <div class="row">
        <button id="startBtn" class="btn primary">スタート</button>
        <button id="howBtn" class="btn">？ 遊び方</button>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="quiz" class="card" aria-live="polite">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div><span id="qIndex">1</span>/<span id="qTotal">1</span></div>
        <div class="pill">正解：<span id="qCorrect">0</span></div>
      </div>
      <div class="progress"><div id="bar" class="bar"></div></div>
      <h2 id="qTitle">問題文</h2>
      <div id="choiceWrap" class="choices" role="group" aria-label="選択肢"></div>
      <div class="foot">
        <button id="nextBtn" class="btn" disabled>次へ ▶</button>
        <span id="judgeText" class="muted"></span>
      </div>
    </section>

    <!-- RESULT -->
    <section id="result" class="card" aria-labelledby="resTitle">
      <h2 id="resTitle">結果</h2>
      <p style="font-size:clamp(24px,4vw,36px);font-weight:800"><span id="scoreText">0/0</span></p>
      <p id="scoreMsg" class="muted"></p>
      <div class="row">
        <button id="retryBtn" class="btn primary">もう一度</button>
        <button id="homeBtn" class="btn">トップへ</button>
      </div>
    </section>
  </div>

  <script>
  // 画面ヘルプ
  document.getElementById('path').textContent = location.pathname + location.search;

  // 問題データ
  const questionBank = [
    { q:'ライス量100g（お子様）の場合、ソース量とお玉は？', choices:['154g／1強','176g／2杯','88g／1杯','120g／1.5杯'], answer:'88g／1杯' },
    { q:'ライス量150g（ハーフ）の場合、ソース量とお玉は？', choices:['176g／2杯','140g／1杯','154g／1強','220g／2.5杯'], answer:'154g／1強' },
    { q:'ライス量200gの場合、ソース量とお玉は？', choices:['176g／2杯','154g／1強','220g／2.5杯','200g／2.5杯'], answer:'176g／2杯' },
    { q:'ライス量250〜300gの場合、ソース量とお玉は？', choices:['200g／2杯','290g／3強','220g／2.5杯','176g／2杯'], answer:'220g／2.5杯' },
    { q:'ライス量350〜400gの場合、ソース量とお玉は？', choices:['220g／2.5杯','290g／3強','360g／4強','440g／5杯'], answer:'290g／3強' },
    { q:'ライス量500gの場合、ソース量とお玉は？', choices:['360g／4強','290g／3強','440g／5杯','484g／5.5杯'], answer:'360g／4強' },
    { q:'ライス量600gの場合、ソース量とお玉は？', choices:['360g／4強','484g／5.5杯','440g／5杯','528g／6杯'], answer:'440g／5杯' },
    { q:'ライス量700gの場合、ソース量とお玉は？', choices:['484g／5.5杯','440g／5杯','528g／6杯','572g／6.5杯'], answer:'484g／5.5杯' },
    { q:'ライス量800gの場合、ソース量とお玉は？', choices:['484g／5.5杯','572g／6.5杯','528g／6杯','600g／6.5杯'], answer:'528g／6杯' },
    { q:'ライス量900gの場合、ソース量とお玉は？', choices:['528g／6杯','650g／7強','572g／6.5杯','484g／5.5杯'], answer:'572g／6.5杯' },
    { q:'ライス量1000gの場合、ソース量とお玉は？', choices:['572g／6.5杯','730g／8強','606g／7強','650g／7強'], answer:'650g／7強' },
    { q:'ライス量1100gの場合、ソース量とお玉は？', choices:['572g／6.5杯','650g／7強','730g／8強','600g／6.5杯'], answer:'650g／7強' },
    { q:'ライス量1200gの場合、ソース量とお玉は？', choices:['650g／7強','572g／6.5杯','694g／7強','730g／8強'], answer:'650g／7強' },
    { q:'ライス量1300gの場合、ソース量とお玉は？', choices:['650g／7強','730g／7強','694g／7強','572g／6.5杯'], answer:'730g／7強' },
    { q:'ライス量1400gの場合、ソース量とお玉は？', choices:['650g／7強','572g／6.5杯','730g／8強','800g／8杯'], answer:'730g／8強' },
    { q:'ライス量1500gの場合、ソース量とお玉は？', choices:['730g／8強','800g／8杯','650g／7強','745g／8強'], answer:'730g／8強' },
  ];

  // ユーティリティ
  const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
  const shuffle=arr=>arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);

  // 要素
  const home=$('#home'), quiz=$('#quiz'), result=$('#result');
  const startBtn=$('#startBtn'), howBtn=$('#howBtn');
  const qCount=$('#qCount'), bankSize=$('#bankSize');
  const qIndex=$('#qIndex'), qTotal=$('#qTotal'), qTitle=$('#qTitle'), choiceWrap=$('#choiceWrap');
  const nextBtn=$('#nextBtn'), judgeText=$('#judgeText'), bar=$('#bar');
  const scoreText=$('#scoreText'), scoreMsg=$('#scoreMsg'), retryBtn=$('#retryBtn'), homeBtn=$('#homeBtn');
  const qCorrectEl=$('#qCorrect');

  bankSize.textContent=`全 ${questionBank.length} 問`;
  qCount.max=questionBank.length; qCount.value=questionBank.length;

  let picked=[], idx=0, correct=0;

  function show(sec){ [home,quiz,result].forEach(s=>s.classList.remove('show')); sec.classList.add('show'); }
  function begin(n){
    picked=shuffle(questionBank).slice(0,n).map(q=>({...q}));
    idx=0; correct=0; qCorrectEl.textContent='0';
    qTotal.textContent=picked.length; nextBtn.disabled=true; judgeText.textContent='';
    show(quiz); render();
  }
  function render(){
    const cur=picked[idx];
    qIndex.textContent=idx+1; qTitle.textContent=cur.q; judgeText.textContent='';
    bar.style.width=`${(idx/picked.length)*100}%`; nextBtn.disabled=true;
    choiceWrap.innerHTML='';
    shuffle(cur.choices).forEach(t=>{
      const b=document.createElement('button'); b.className='choice'; b.textContent=t; b.type='button';
      b.addEventListener('click',()=>onPick(b,t,cur.answer)); choiceWrap.appendChild(b);
    });
  }
  function onPick(btn, pickedText, answer){
    if(nextBtn.disabled===false) return;
    const buttons=$$('.choice'); buttons.forEach(b=>b.disabled=true);
    const ok=pickedText===answer;
    btn.classList.add(ok?'correct':'wrong'); judgeText.textContent= ok?'正解！':'不正解…'; judgeText.style.color= ok?'var(--ok)':'var(--ng)';
    if(ok){ correct++; qCorrectEl.textContent=String(correct); }
    const a=buttons.find(b=>b.textContent===answer); if(a) a.classList.add('correct');
    nextBtn.disabled=false;
  }
  function finish(){
    bar.style.width='100%'; scoreText.textContent=`${correct} / ${picked.length}`;
    const r=correct/picked.length; scoreMsg.textContent= r>=.9?'完璧！現場マスター！': r>=.7?'いい感じ、この調子！':'もう一息。復習してもう一度挑戦しよう。';
    show(result);
  }

  startBtn.addEventListener('click',()=>begin(Math.max(1,Math.min(parseInt(qCount.value||'1',10),questionBank.length))));
  retryBtn.addEventListener('click',()=>begin(picked.length));
  homeBtn.addEventListener('click',()=>show(home));
  howBtn.addEventListener('click',()=>alert('4択問題です。出題数を選んでスタート。選択肢は毎回シャッフルされます。'));
  nextBtn.addEventListener('click',()=>{ idx++; if(idx>=picked.length) finish(); else render(); });
  qCount.addEventListener('input',()=>{ const v=parseInt(qCount.value||'1',10); if(Number.isNaN(v)||v<1) qCount.value=1; else if(v>questionBank.length) qCount.value=questionBank.length; });
  </script>
</body>
</html>
